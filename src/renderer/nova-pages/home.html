<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nova Browser - Home</title>
  <link rel="stylesheet" href="nova://shared/theme.css">
  <style>
    :root {
      /* Light theme (default) */
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --bg-gradient-dark: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      --text-primary: #ffffff;
      --card-bg: rgba(255,255,255,0.1);
      --card-bg-hover: rgba(255,255,255,0.2);
      --card-bg-dark: rgba(255,255,255,0.05);
      --card-bg-dark-hover: rgba(255,255,255,0.1);
      --input-bg: #ffffff;
      --input-text: #333333;
      --button-bg: rgba(255,255,255,0.2);
      --button-bg-hover: rgba(255,255,255,0.3);
      --shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    [data-theme="dark"] {
      --bg-gradient: var(--bg-gradient-dark);
      --card-bg: var(--card-bg-dark);
      --card-bg-hover: var(--card-bg-dark-hover);
      --input-bg: #2d2d2d;
      --input-text: #ffffff;
      --shadow: 2px 2px 8px rgba(0,0,0,0.5);
    }

    * {
      transition: background 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
    }

    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-gradient);
      margin: 0; 
      padding: 40px; 
      text-align: center; 
      color: var(--text-primary);
      min-height: 100vh;
    }
    
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
    }
    
    h1 { 
      font-size: 3em; 
      margin-bottom: 20px; 
      text-shadow: var(--shadow);
    }
    
    .search-box { 
      margin: 20px 0; 
    }
    
    .search-box input { 
      width: 400px; 
      padding: 15px; 
      border: none; 
      border-radius: 25px; 
      font-size: 16px; 
      outline: none; 
      text-align: center;
      background: var(--input-bg);
      color: var(--input-text);
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .search-box input::placeholder {
      color: var(--input-text);
      opacity: 0.7;
    }
    
    .search-box button {
      background: var(--button-bg);
      color: var(--text-primary);
      border: none;
      padding: 15px 25px; 
      border-radius: 25px; 
      margin-left: 10px;
      cursor: pointer; 
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .search-box button:hover { 
      background: var(--button-bg-hover);
      transform: translateY(-2px);
    }
    
    .quick-links { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
      gap: 20px; 
      margin-top: 40px; 
    }
    
    .link-card { 
      background: var(--card-bg);
      padding: 20px; 
      border-radius: 15px; 
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px); 
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .link-card:hover { 
      transform: translateY(-5px);
      background: var(--card-bg-hover);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .link-card a { 
      color: var(--text-primary); 
      text-decoration: none; 
      font-weight: bold; 
      display: block;
      font-size: 1.1em;
    }

    /* Theme toggle button */
    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: none;
      color: var(--text-primary);
      padding: 10px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 16px;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .theme-toggle:hover {
      background: var(--card-bg-hover);
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <button class="theme-toggle" id="themeToggle">üåô</button>
  <div class="container">
    <h1>Welcome to Nova Browser</h1>
    <p>Your gateway to the web</p>
    
    <div class="search-box">
      <input type="text" id="homeSearch" placeholder="Search or enter URL..." />
      <button onclick="performSearch()">Search</button>
    </div>
    
    <div class="quick-links">
      <div class="link-card" onclick="navigateToUrl('https://google.com')">
        <a href="#">üîç Google Search</a>
      </div>
      <div class="link-card" onclick="navigateToUrl('https://github.com')">
        <a href="#">üêô GitHub</a>
      </div>
      <div class="link-card" onclick="navigateToUrl('nova://settings')">
        <a href="#">‚öôÔ∏è Browser Settings</a>
      </div>
      <div class="link-card" onclick="navigateToUrl('nova://about')">
        <a href="#">‚ÑπÔ∏è About Nova</a>
      </div>
      <div class="link-card" onclick="navigateToUrl('nova://history')">
        <a href="#">üìú Browse History</a>
      </div>
      <div class="link-card" onclick="navigateToUrl('nova://bookmarks')">
        <a href="#">üìö Bookmarks</a>
      </div>
    </div>
  </div>

  <script src="nova://shared/theme.js"></script>
  <script>
    // Initialize theme system when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Home page DOM loaded');
      
      // Set up theme toggle button
      const themeToggle = document.getElementById('themeToggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', async function() {
          console.log('Home page theme toggle clicked');
          
          // Get current theme state
          const html = document.documentElement;
          const currentTheme = html.getAttribute('data-theme');
          const isDark = currentTheme === 'dark';
          const newTheme = isDark ? 'light' : 'dark';
          
          // Apply theme immediately to the page
          if (newTheme === 'dark') {
            html.setAttribute('data-theme', 'dark');
            this.textContent = '‚òÄÔ∏è';
            this.title = 'Switch to light mode';
          } else {
            html.setAttribute('data-theme', 'light');
            this.textContent = 'üåô';
            this.title = 'Switch to dark mode';
          }
          
          // Store the preference
          localStorage.setItem('nova-theme', newTheme);
          
          // Try to update Nova settings if available
          if (window.novaSettings) {
            try {
              await window.novaSettings.set('dark-mode', newTheme === 'dark');
              console.log('Updated Nova settings with theme:', newTheme);
            } catch (error) {
              console.error('Failed to save theme to Nova settings:', error);
            }
          }
          
          // Notify main window if we're in a webview
          if (window !== window.parent) {
            try {
              window.parent.postMessage({
                type: 'nova-theme-changed',
                theme: newTheme
              }, '*');
            } catch (error) {
              console.log('Could not notify parent window of theme change:', error);
            }
          }
          
          console.log('Theme switched to:', newTheme);
        });
      }
      
      // Listen for theme system ready event
    window.addEventListener('nova-theme-ready', async function(event) {
      console.log('Nova theme system is ready:', event.detail);
      
      // Initialize theme system
      console.log('Initializing home page theme...');
      
      // Get theme toggle button
      const themeToggle = document.getElementById('themeToggle');
      const html = document.documentElement;
      
      // Get theme preference (check stored theme, then system preference, then Nova settings)
      let isDarkMode = false;
      
      const storedTheme = localStorage.getItem('nova-theme');
      if (storedTheme) {
        // Use stored preference if exists
        isDarkMode = storedTheme === 'dark';
      } else {
        // Detect system preference
        const systemPrefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        isDarkMode = systemPrefersDark;
        
        // If no stored preference, check Nova settings as fallback
        if (window.novaSettings) {
          try {
            const novaTheme = await window.novaSettings.get('dark-mode', systemPrefersDark);
            isDarkMode = novaTheme;
          } catch (error) {
            console.log('Could not get theme from Nova settings, using system preference:', error);
          }
        }
        
        console.log('No stored theme preference, using system preference:', isDarkMode ? 'dark' : 'light');
      }
      
      // Apply theme
      if (isDarkMode) {
        html.setAttribute('data-theme', 'dark');
        if (themeToggle) {
          themeToggle.textContent = '‚òÄÔ∏è';
          themeToggle.title = 'Switch to light mode';
        }
      } else {
        html.setAttribute('data-theme', 'light');
        if (themeToggle) {
          themeToggle.textContent = 'üåô';
          themeToggle.title = 'Switch to dark mode';
        }
      }
      
      console.log('Home page theme initialized:', isDarkMode ? 'dark' : 'light');
      
      // Listen for system theme changes
      if (window.matchMedia) {
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        mediaQuery.addEventListener('change', function(e) {
          // Only auto-switch if user hasn't set a manual preference
          const storedTheme = localStorage.getItem('nova-theme');
          if (!storedTheme) {
            const systemPrefersDark = e.matches;
            const html = document.documentElement;
            const themeToggle = document.getElementById('themeToggle');
            
            if (systemPrefersDark) {
              html.setAttribute('data-theme', 'dark');
              if (themeToggle) {
                themeToggle.textContent = '‚òÄÔ∏è';
                themeToggle.title = 'Switch to light mode';
              }
            } else {
              html.setAttribute('data-theme', 'light');
              if (themeToggle) {
                themeToggle.textContent = 'üåô';
                themeToggle.title = 'Switch to dark mode';
              }
            }
            
            // Update Nova settings
            if (window.novaSettings) {
              try {
                window.novaSettings.set('dark-mode', systemPrefersDark);
              } catch (error) {
                console.log('Could not save system theme change to Nova settings:', error);
              }
            }
            
            console.log('System theme changed to:', systemPrefersDark ? 'dark' : 'light');
          }
        });
      }
    });

    function navigateToUrl(url) {
      // Use the preload script function if available
      if (window.navigateFromNova) {
        window.navigateFromNova(url);
      } else {
        // Fallback: try to navigate directly
        window.location.href = url;
      }
    }

    function performSearch() {
      const searchTerm = document.getElementById('homeSearch').value;
      if (searchTerm.trim()) {
        // Check if it's a URL or search term
        const urlRegex = /^(https?:\/\/[^\s]+|www\.[^\s]+|[a-z0-9-]+\.[a-z]{2,})(\/[^\s]*)?$/i;
        let url;
        
        if (urlRegex.test(searchTerm)) {
          url = searchTerm.startsWith('http') ? searchTerm : 'https://' + searchTerm;
        } else {
          url = 'https://www.google.com/search?q=' + encodeURIComponent(searchTerm);
        }
        
        navigateToUrl(url);
      }
    }

    // Allow Enter key in search box
    document.getElementById('homeSearch').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });
  });
  </script>
</body>
</html>
